<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_report_personalizated" model="ir.actions.report">
        <field name="name">Orden de producción personalizada</field>
        <field name="model">mrp.production</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">mrp_production_report.report_personalizated</field>
        <field name="report_file">mrp_production_report.report_personalizated</field>
        <field name="print_report_name">('OPs - Consolidado')</field>
        <field name="binding_model_id" ref="mrp.model_mrp_production"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_mrp_production_personalizated">
        <div class="article o_report_layout_standard">

            <div class="page">
                <div style="width: 100%; text-align: right; font-size: 12px; margin-bottom: 5px;">
                    Página <span class="page"/> de <span class="topage"/>
                </div>

                <h2 style="text-align:center;">Resumen de Órdenes de Producción</h2>

                <h3>Órdenes de Producción</h3>
                <table class="table table-sm" style="width: 100%; font-size: 13px; border-collapse: collapse;" border="1">
                    <thead>
                        <tr style="background-color: #f0f0f0;">
                            <th>Nombre</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>U.Medida</th>
                            <th>Cliente</th>
                            <th>Asesor</th>
                            <th>Fecha</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="docs" t-as="o">
                            <tr>
                                <td t-esc="o.name"/>
                                <td t-esc="o.product_id.display_name"/>
                                <td t-esc="o.product_qty"/>
                                <td t-esc="o.product_uom_id.name"/>
                                <td t-esc="o.sale_id.partner_id.name or 'N/A'"/>
                                <td t-esc="o.sale_id.user_id.name or 'N/A'"/>
                                <td>
                                    <t t-if="o.sale_id.date_order">
                                        <t t-esc="o.sale_id.date_order.strftime('%Y-%m-%d')"/>
                                    </t>
                                    <t t-if="not o.sale_id.date_order">N/A</t>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>

            <t t-foreach="grupos_consolidados" t-as="grupo">
                <div class="page" style="page-break-before: always !important; page-break-after: always !important;">
                    <div style="width: 100%; text-align: right; font-size: 12px; margin-bottom: 5px;">
                        Página <span class="page"/> de <span class="topage"/>
                    </div>

                    <h3>Componentes por Centro de Trabajo</h3>
                    <h4><strong>Centro de trabajo:</strong> <t t-esc="grupo[0]"/></h4>
                    <table class="table table-sm" style="width:100%;" border="1">
                        <thead>
                            <tr style="background-color: #f0f0f0;">
                                <th>Item</th>
                                <th>Producto</th>
                                <th>Unidad</th>
                                <th>Cantidad</th>
                                <th>OP</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="contador" t-value="1"/>
                            <t t-foreach="grupo[1]" t-as="linea">
                                <tr>
                                    <td><t t-esc="contador"/></td>
                                    <td><t t-esc="linea['product'].display_name"/></td>
                                    <td><t t-esc="linea['uom'].name"/></td>
                                    <td><t t-esc="linea['qty']"/></td>
                                    <td><t t-esc="', '.join(linea['op_names'])"/></td>
                                </tr>
                                <t t-set="contador" t-value="contador + 1"/>
                            </t>
                        </tbody>
                    </table>
                </div>
            </t>

        </div>
    </template>

    <template id="report_personalizated">
        <t t-call="web.html_container">
            <t t-call="web.external_layout"/>
            <t t-call="mrp_production_report.report_mrp_production_personalizated"/>
        </t>
    </template>

</odoo>
