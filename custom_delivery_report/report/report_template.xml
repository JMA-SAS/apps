<odoo>
  <data>

    <template id="report_custom_delivery">
      <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
          <t t-call="web.external_layout">

            <div class="page">
              <br/><br/>
              <h2>Albarán de Entrega</h2>
              <p><strong>Referencia:</strong> <span t-esc="o.name"/></p>
              <p><strong>Cliente:</strong> <span t-esc="o.partner_id.name"/></p>
              <p><strong>Fecha:</strong> <span t-esc="o.scheduled_date.strftime('%Y-%m-%d')"/></p>

              <!-- Variables para totalización -->
              <t t-set="qty_total" t-value="sum((l.quantity or 0) for l in o.move_ids_without_package)"/>
              <t t-set="cost_unit_total" t-value="sum((l.product_standard_price or 0.0) for l in o.move_ids_without_package)"/>
              <t t-set="cost_total_total" t-value="sum((l.standard_total_cost or 0.0) for l in o.move_ids_without_package)"/>

              <table class="table table-sm" style="margin-top:20px;" name="custom_stock_table">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Costo Unitario</th>
                    <th>Costo Total</th>
                    <th>Unidad</th>
                  </tr>
                </thead>
                <tbody>
                  <tr t-foreach="o.move_ids_without_package" t-as="line">
                    <td>
                      <span t-esc="line.product_id.display_name"/>
                    </td>
                    <td>
                      <span t-esc="line.quantity"/>
                    </td>
                    <td>
                      <span t-esc="'{:,.2f}'.format(float(line.product_standard_price))"/>
                    </td>
                    <td>
                      <span t-esc="'{:,.2f}'.format(float(line.standard_total_cost))"/>
                    </td>
                    <td>
                      <span t-esc="line.product_uom.name"/>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td><strong>Totales:</strong></td>
                    <td><strong><span t-esc="qty_total"/></strong></td>
                    <td><strong></strong></td>
                    <td><strong><span t-esc="'{:,.2f}'.format(float(cost_total_total))"/></strong></td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>

            </div>

          </t>
        </t>
      </t>
    </template>

  </data>
</odoo>